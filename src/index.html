<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Maps Timeline Viewer - Mapbox Edition</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div id="controls" class="expanded">
      <div id="controlsHeader">
        <h1>Timeline Viewer</h1>
        <span id="controlsChevron" data-icon="chevronDown"></span>
      </div>

      <div id="controlsContent">
        <div class="control-group">
          <label for="timezoneSelect">Timezone</label>
          <select id="timezoneSelect">
            <option value="UTC">UTC</option>
            <option value="America/New_York">America/New_York (EST/EDT)</option>
            <option value="America/Chicago">America/Chicago (CST/CDT)</option>
            <option value="America/Denver">America/Denver (MST/MDT)</option>
            <option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option>
            <option value="Europe/London">Europe/London (GMT/BST)</option>
            <option value="Europe/Paris">Europe/Paris (CET/CEST)</option>
            <option value="Asia/Dubai">Asia/Dubai (GST)</option>
            <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
            <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
            <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
            <option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option>
          </select>
        </div>

        <div class="control-group">
          <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 5px">
            <input type="checkbox" id="useRawData" checked style="margin-right: 8px" />
            <span style="font-size: 12px">Use Raw GPS Data (more detailed)</span>
          </label>
        </div>

        <div class="control-group">
          <label for="routeColorMode">Route Color Mode</label>
          <select id="routeColorMode">
            <option value="none">None</option>
            <option value="speed">Speed-based</option>
            <option value="activity">Activity-based</option>
          </select>
        </div>

        <div class="control-group">
          <label for="fileInput">Upload Timeline JSON</label>
          <label for="fileInput" class="file-upload-btn">Choose File</label>
          <input type="file" id="fileInput" accept=".json" />
          <div class="filename" id="filename"></div>
        </div>
      </div>
    </div>

    <div id="info">
      <h3>Location</h3>
      <p id="locationName">-</p>
      <h3 style="margin-top: 10px">Activity</h3>
      <p id="activityType">-</p>
    </div>

    <div id="slider-container">
      <button id="playBtn" data-icon="play"></button>
      <div id="sliderContent">
        <div id="timeDisplay">
          <select id="dateSelect" disabled>
            <option>Load a file first...</option>
          </select>
          <span id="timeText">00:00</span>
        </div>
        <input type="range" id="timeSlider" min="0" max="1439" value="0" step="1" />
      </div>
    </div>

    <div id="console" class="minimized">
      <div id="consoleHeader">
        <h3>Timeline Data</h3>
        <span id="consoleChevron" data-icon="chevronDown"></span>
      </div>
      <div id="consoleContent"></div>
    </div>

    <div id="mapContainer">
      <div id="map"></div>

      <!-- Help Button -->
      <button id="helpBtn" class="help-btn">
        <span id="helpIcon" data-icon="helpCircle"></span>
      </button>

      <!-- Help Modal -->
      <div id="helpModal" class="help-modal" style="display: none">
        <div class="help-modal-content">
          <div class="help-modal-header">
            <h4>Help & Guide</h4>
            <button id="helpCloseBtn" class="help-close-btn">&times;</button>
          </div>
          <div class="help-modal-body">
            <!-- Table of Contents -->
            <div class="help-toc">
              <h5>Quick Navigation</h5>
              <ul>
                <li><a href="#getting-data">Getting Your Timeline Data</a></li>
                <li><a href="#using-app">Using the App</a></li>
                <li><a href="#legend">Route Color Legend</a></li>
              </ul>
            </div>

            <!-- Getting Data Section -->
            <div id="getting-data" class="help-section">
              <h3>Getting Your Timeline Data</h3>

              <!-- Android Section -->
              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconAndroid"></span>
                  <span>From Android Device</span>
                  <span class="help-chevron" id="helpChevronAndroid"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <h4>Method 1: Google Takeout (Recommended)</h4>
                    <ol>
                      <li>Go to <a href="https://takeout.google.com/" target="_blank">takeout.google.com</a></li>
                      <li>Deselect all products, then select <strong>"Location History"</strong></li>
                      <li>Click "All location history data included"</li>
                      <li>Select <strong>"Timeline"</strong> format (JSON)</li>
                      <li>Click "Next step" and choose your export settings</li>
                      <li>Click "Create export" and wait for the email</li>
                      <li>Download and extract the ZIP file</li>
                      <li>Find <code>Timeline.json</code> in the <code>Location History/Timeline</code> folder</li>
                    </ol>

                    <h4>Method 2: Google Maps App</h4>
                    <ol>
                      <li>Open Google Maps app</li>
                      <li>Tap your profile picture → <strong>Your Timeline</strong></li>
                      <li>Tap the three dots (⋮) → <strong>Settings and privacy</strong></li>
                      <li>Scroll to <strong>Export Timeline data</strong></li>
                      <li>Choose date range and format (JSON)</li>
                      <li>Download the exported file</li>
                    </ol>
                  </div>
                </div>
              </div>

              <!-- iOS Section -->
              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconIOS"></span>
                  <span>From iOS Device</span>
                  <span class="help-chevron" id="helpChevronIOS"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <h4>Method 1: Google Maps App</h4>
                    <ol>
                      <li>Open Google Maps app</li>
                      <li>Tap your profile picture → <strong>Your Timeline</strong></li>
                      <li>Tap the three dots (⋯) → <strong>Settings and privacy</strong></li>
                      <li>Scroll to <strong>Export Timeline data</strong></li>
                      <li>Choose date range and format (JSON)</li>
                      <li>Download the exported file</li>
                    </ol>

                    <h4>Method 2: Google Takeout</h4>
                    <ol>
                      <li>Go to <a href="https://takeout.google.com/" target="_blank">takeout.google.com</a></li>
                      <li>Follow the same <strong>Google Takeout</strong> steps as Android above</li>
                    </ol>
                  </div>
                </div>
              </div>

              <!-- Google Takeout Section -->
              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconDesktop"></span>
                  <span>From Google Takeout (Desktop)</span>
                  <span class="help-chevron" id="helpChevronDesktop"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <ol>
                      <li>Open <a href="https://takeout.google.com/" target="_blank">takeout.google.com</a> in your browser</li>
                      <li>Sign in to your Google account</li>
                      <li>Click "Deselect all" to uncheck everything</li>
                      <li>Scroll down and check <strong>"Location History"</strong></li>
                      <li>Click "All location history data included"</li>
                      <li>Select only <strong>"Timeline"</strong> (uncheck other options)</li>
                      <li>Choose <strong>JSON</strong> format</li>
                      <li>Click "OK" then "Next step"</li>
                      <li>Choose export frequency (one-time) and file size</li>
                      <li>Click "Create export"</li>
                      <li>Wait for email notification (can take hours for large datasets)</li>
                      <li>Download and extract the ZIP file</li>
                      <li>Locate <code>Timeline.json</code> in the extracted folder</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>

            <!-- Using App Section -->
            <div id="using-app" class="help-section">
              <h3>Using the App</h3>

              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconUpload"></span>
                  <span>Loading Your Data</span>
                  <span class="help-chevron" id="helpChevronUpload"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <ol>
                      <li>Click <strong>"Choose File"</strong> in the controls panel</li>
                      <li>Select your <code>Timeline.json</code> file</li>
                      <li>Wait for the file to load (may take a moment for large files)</li>
                      <li>Select a date from the <strong>"Select Date"</strong> dropdown</li>
                      <li>Your timeline will appear on the map!</li>
                    </ol>
                    <p><strong>Note:</strong> All processing happens in your browser. Your data never leaves your device.</p>
                  </div>
                </div>
              </div>

              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconSettings"></span>
                  <span>Controls & Features</span>
                  <span class="help-chevron" id="helpChevronSettings"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <ul>
                      <li><strong>Timezone:</strong> View your timeline in different timezones</li>
                      <li><strong>Use Raw GPS Data:</strong> Toggle between detailed GPS data and semantic segments</li>
                      <li><strong>Route Color Mode:</strong>
                        <ul>
                          <li><em>None:</em> Default blue route</li>
                          <li><em>Speed-based:</em> Colors based on movement speed (red→yellow→green→blue)</li>
                          <li><em>Activity-based:</em> Colors based on activity type (walking, driving, flying, etc.)</li>
                        </ul>
                      </li>
                      <li><strong>Play Button:</strong> Animate your day's timeline</li>
                      <li><strong>Time Slider:</strong> Scrub through your day manually</li>
                      <li><strong>Date Navigation:</strong> Use arrow buttons to move between dates</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Legend Section -->
            <div id="legend" class="help-section">
              <h3>Route Color Legend</h3>

              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconActivity"></span>
                  <span>Activity-Based Colors</span>
                  <span class="help-chevron" id="helpChevronActivity"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #22c55e"></span>
                      <span class="legend-label">Walking</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #f97316"></span>
                      <span class="legend-label">Running</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #8b5cf6"></span>
                      <span class="legend-label">Cycling</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #d946ef"></span>
                      <span class="legend-label">Motorcycling</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #3b82f6"></span>
                      <span class="legend-label">In Vehicle/Driving</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #a855f7"></span>
                      <span class="legend-label">In Subway</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #06b6d4"></span>
                      <span class="legend-label">In Rail Vehicle</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #f59e0b"></span>
                      <span class="legend-label">In Bus</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #ec4899"></span>
                      <span class="legend-label">Flying</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #ef4444"></span>
                      <span class="legend-label">Still</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #9ca3af"></span>
                      <span class="legend-label">Unknown</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="help-collapsible">
                <button class="help-collapsible-header">
                  <span class="help-icon" id="helpIconSpeed"></span>
                  <span>Speed-Based Colors</span>
                  <span class="help-chevron" id="helpChevronSpeed"></span>
                </button>
                <div class="help-collapsible-content">
                  <div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #ef4444"></span>
                      <span class="legend-label">Stationary (&lt;1 m/s)</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #eab308"></span>
                      <span class="legend-label">Walking (1-5 m/s)</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #22c55e"></span>
                      <span class="legend-label">Cycling (5-15 m/s)</span>
                    </div>
                    <div class="legend-item">
                      <span class="legend-color" style="background: #3b82f6"></span>
                      <span class="legend-label">Driving (&gt;15 m/s)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Disclaimers Section -->
            <div class="help-section" style="border-top: 1px solid #e5e7eb; margin-top: 24px; padding-top: 24px;">
              <h3>Disclaimers</h3>

              <div style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                <p style="margin-bottom: 12px;">
                  <strong>Trademarks:</strong> This is an unofficial, independent tool and is not affiliated with, endorsed by, or sponsored by Google LLC or Alphabet Inc. Google®, Google Maps™, Google Timeline™, and Google Takeout™ are trademarks of Google LLC.
                </p>

                <p style="margin-bottom: 12px;">
                  <strong>Map Data:</strong> Map tiles and data © <a href="https://www.openstreetmap.org/copyright" target="_blank" style="color: #5e6ad2;">OpenStreetMap</a> contributors. Maps powered by <a href="https://leafletjs.com/" target="_blank" style="color: #5e6ad2;">Leaflet</a>.
                </p>

                <p style="margin-bottom: 12px;">
                  <strong>Privacy:</strong> This application processes your location data entirely in your web browser. No data is sent to any server or third party. You maintain full control and ownership of your data.
                </p>

                <p style="margin-bottom: 0;">
                  <strong>License:</strong> This software is provided "as is" under the MIT License without warranty of any kind. See the project repository for full license details.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
      <div style="background: white; padding: 30px 50px; border-radius: 8px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #5e6ad2; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
        <div id="loadingText" style="font-size: 16px; color: #333; font-weight: 500;">Loading...</div>
      </div>
    </div>

    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>

    <script type="module" src="/app.ts"></script>
  </body>
</html>
